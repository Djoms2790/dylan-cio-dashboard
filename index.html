<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dylan CIO | Weekly Interactive Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f0; color: #334155; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .chart-container { position: relative; height: 350px; width: 100%; }
        .glass-panel { background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .status-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; }
        .tab-active { border-bottom: 2px solid #0f172a; color: #0f172a; font-weight: 600; }
        .tab-inactive { border-bottom: 2px solid transparent; color: #64748b; }
        .share-input { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.375rem; padding: 0.25rem 0.5rem; width: 80px; text-align: right; font-family: 'JetBrains Mono', monospace; }
        .editable-price { border-bottom: 1px dashed #94a3b8; cursor: pointer; }
    </style>
</head>
<body class="antialiased min-h-screen">

    <header class="bg-slate-900 text-white sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <span class="text-2xl">üá®üá≠</span>
                <div class="flex flex-col"><span class="font-bold text-lg tracking-tight">DYLAN CIO</span><span class="text-xs text-slate-400 mono">GENEVA // LIVE</span></div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="hidden md:flex space-x-6 text-sm font-medium text-slate-300">
                    <a href="#mydesk" class="hover:text-white">Desk</a><a href="#macro" class="hover:text-white">Macro</a><a href="#performance" class="hover:text-white">Perf</a>
                </div>
                <div class="flex items-center bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                    <img src="https://github.com/djoms2790/dylan-cio-dashboard/actions/workflows/monday_update.yml/badge.svg" class="h-4">
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 space-y-12">
        <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="col-span-1 md:col-span-2 bg-white rounded-xl p-8 shadow-sm border-l-4 border-slate-800">
                <p class="text-sm font-bold text-slate-500 uppercase mb-1">Weekly Snapshot</p>
                <h1 class="text-3xl font-bold text-slate-900 mb-2" id="regime-title">...</h1>
                <p class="text-slate-600 leading-relaxed">Date: <span class="font-bold text-slate-800" id="report-date">...</span><br><span id="exec-summary">...</span></p>
            </div>
            <div class="col-span-1 bg-slate-100 rounded-xl p-6 text-center border border-slate-200">
                <div class="text-2xl mb-2">üõ°Ô∏è</div>
                <h2 class="text-lg font-bold text-slate-800">Status</h2>
                <div class="mt-2 px-4 py-1 bg-white border border-slate-300 rounded-full text-sm font-bold text-slate-700 shadow-sm" id="ptf-status">...</div>
            </div>
        </section>

        <section id="mydesk" class="bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
            <div class="px-6 py-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                <h2 class="text-xl font-bold text-slate-800">üíº My Desk</h2>
                <div class="flex space-x-4 text-sm">
                    <button onclick="switchTab('holdings')" id="tab-holdings" class="tab-active pb-2">Holdings</button>
                    <button onclick="switchTab('ledger')" id="tab-ledger" class="tab-inactive pb-2">Ledger</button>
                    <button onclick="switchTab('pnl')" id="tab-pnl" class="tab-inactive pb-2">Perf</button>
                </div>
            </div>
            <div class="p-6">
                <div id="view-holdings">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="text-xs text-slate-500 uppercase bg-slate-50"><tr><th class="px-4 py-3">Asset</th><th class="px-4 py-3 text-right">Price</th><th class="px-4 py-3 text-right">Shares</th><th class="px-4 py-3 text-right">Value</th><th class="px-4 py-3 text-right">Weight</th></tr></thead>
                                <tbody id="holdings-body" class="divide-y divide-slate-100"></tbody>
                                <tfoot class="bg-slate-50 font-bold"><tr><td class="px-4 py-3" colspan="3">Total</td><td class="px-4 py-3 text-right" id="total-value">CHF 0.00</td><td></td></tr></tfoot>
                            </table>
                        </div>
                        <div class="lg:col-span-1 flex flex-col items-center justify-center bg-slate-50 rounded-xl p-4 border border-slate-100">
                            <h4 class="text-xs font-bold text-slate-500 uppercase mb-4">Allocation</h4>
                            <div class="chart-container-small"><canvas id="holdingsPieChart"></canvas></div>
                        </div>
                    </div>
                </div>
                <div id="view-ledger" class="hidden">
                    <div class="flex justify-between mb-4"><h3 class="font-bold text-slate-500 text-sm uppercase">History</h3><button class="text-xs bg-slate-100 px-3 py-1 rounded" onclick="prompt('Import CSV feature pending database.')">Import CSV</button></div>
                    <table class="w-full text-sm text-left"><thead class="bg-slate-50 text-xs text-slate-500 uppercase"><tr><th class="px-6 py-3">Date</th><th class="px-6 py-3">Type</th><th class="px-6 py-3">Asset</th><th class="px-6 py-3 text-right">Qty</th><th class="px-6 py-3 text-right">Price</th><th class="px-6 py-3 text-right">Total</th></tr></thead><tbody id="ledger-body"></tbody></table>
                </div>
                <div id="view-pnl" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="bg-slate-50 rounded-xl p-6 border border-slate-100">
                            <div class="text-xs text-slate-400 uppercase font-bold mb-1">Unrealized P&L</div>
                            <div class="text-4xl font-bold mono" id="total-pnl">CHF 0.00</div>
                            <div class="text-sm font-medium mt-2" id="pnl-percent">0.00%</div>
                        </div>
                        <div class="h-64"><canvas id="pnlBarChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="macro">
            <h2 class="text-2xl font-bold mb-6">üß≠ Macro Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4" id="macro-grid"></div>
        </section>

        <section id="performance" class="bg-white rounded-2xl shadow-sm border p-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold">üìä Performance</h2>
                <div class="space-x-2 text-xs"><button onclick="updatePerf('1w')" class="px-3 py-1 bg-slate-100 rounded">1W</button><button onclick="updatePerf('ytd')" class="px-3 py-1 bg-slate-100 rounded">YTD</button><button onclick="updatePerf('1y')" class="px-3 py-1 bg-slate-100 rounded">1Y</button></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2"><div class="chart-container"><canvas id="performanceChart"></canvas></div></div>
                <div class="lg:col-span-1 bg-slate-50 rounded-xl p-6 flex flex-col justify-center text-sm italic text-slate-600" id="commentary-display">Select chart...</div>
            </div>
        </section>

        <section id="orders" class="pb-12">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-slate-800 text-white rounded-xl p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-10 text-9xl">üìà</div>
                    <h3 class="text-lg font-medium text-slate-300">Algo Trend</h3>
                    <div class="text-4xl font-bold text-emerald-400 mb-4" id="algo-trend">NEUTRAL</div>
                    <div class="w-full bg-slate-700 h-2 rounded-full"><div class="bg-emerald-500 h-full w-3/4"></div></div>
                </div>
                <div class="bg-white rounded-xl p-6 border shadow-sm">
                    <h3 class="font-bold text-slate-800 mb-4">Monday Orders</h3>
                    <div id="order-list" class="space-y-2"></div>
                    <button id="execute-btn" class="mt-4 w-full bg-slate-900 text-white py-2 rounded text-sm hover:bg-slate-800 transition">Execute & Log ‚Üí</button>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center py-8 text-xs text-slate-400 border-t bg-white">
        <p>Dylan CIO System &copy; 2026. Geneva, CH.</p>
        <p id="last-updated" class="mt-1 font-mono">Syncing...</p>
    </footer>

    <script>
        // --- INJECTED DATA ---
        const reportData = {"meta": {"regime": "Market Data Synced", "date": "Saturday, Feb 14, 2026", "summary": "Live prices updated from SIX Swiss Exchange.", "status": "Active", "reasoning": "Monitoring volatility levels."}, "algo": {"trend": "NEUTRAL"}, "macro": [{"name": "USD/CHF", "value": "0.77", "trend": "Live", "impact": "Neutral", "desc": "Real-time FX."}, {"name": "VIX", "value": "20.6", "trend": "Live", "impact": "Caution", "desc": "Volatility Index."}, {"name": "Fed Rate", "value": "3.59%", "trend": "High", "impact": "Neutral", "desc": "13-Wk T-Bill."}], "assets": [{"id": "EQCH", "name": "Invesco Nasdaq 100", "color": "#ef4444", "price": 396.45, "change_1w": -0.69, "change_ytd": -3.62, "change_1y": 8.54, "commentary": "Weekly change: -0.69%"}, {"id": "SP500S", "name": "UBS S&P 500", "color": "#f87171", "price": 6.16, "change_1w": -0.64, "change_ytd": -1.14, "change_1y": 9.45, "commentary": "Weekly change: -0.64%"}, {"id": "IWVL", "name": "iShares World Value", "color": "#10b981", "price": 66.58, "change_1w": 1.09, "change_ytd": 9.74, "change_1y": 46.04, "commentary": "Weekly change: 1.09%"}, {"id": "SMHV", "name": "VanEck Semis", "color": "#fbbf24", "price": 55.34, "change_1w": 2.94, "change_ytd": 5.45, "change_1y": 42.83, "commentary": "Weekly change: 2.94%"}, {"id": "AUCHAH", "name": "UBS Gold Hedged", "color": "#f59e0b", "price": 165.14, "change_1w": 1.49, "change_ytd": 11.87, "change_1y": 62.38, "commentary": "Weekly change: 1.49%"}], "performance": {"commentary": "Click bars to view details."}, "breakers": [{"name": "VIX", "status": "CAUTION", "level": "20.6", "color": "text-emerald-500", "dot": "bg-emerald-500"}, {"name": "FX Floor", "status": "SAFE", "level": "0.77", "color": "text-emerald-500", "dot": "bg-emerald-500"}], "orders": [{"action": "HOLD", "asset": "Portfolio", "shares": "-", "reason": "Standard monitoring."}]};

        // --- STATE ---
        let userHoldings = { "EQCH": 150, "SP500S": 80, "IWVL": 200, "SMHV": 60, "AUCHAH": 10 };
        let ledger = [{ date: "2026-02-01", type: "DEPOSIT", asset: "CASH", qty: "-", price: 1.00, total: 100000 }];

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            // Text Fills
            document.getElementById('regime-title').innerText = reportData.meta.regime || "System Online";
            document.getElementById('report-date').innerText = reportData.meta.date;
            document.getElementById('exec-summary').innerText = reportData.meta.summary;
            document.getElementById('ptf-status').innerText = reportData.meta.status;
            document.getElementById('algo-trend').innerText = reportData.algo.trend;
            
            initMacro();
            renderHoldings();
            renderLedger();
            initCharts();
            initOrders();
            getSync();
        });

        // --- TABS ---
        window.switchTab = function(t) {
            ['holdings','ledger','pnl'].forEach(x => {
                document.getElementById(`view-${x}`).classList.add('hidden');
                document.getElementById(`tab-${x}`).className = 'tab-inactive pb-2 transition-colors';
            });
            document.getElementById(`view-${t}`).classList.remove('hidden');
            document.getElementById(`tab-${t}`).className = 'tab-active pb-2 transition-colors';
        }

        // --- RENDER ---
        function renderHoldings() {
            const body = document.getElementById('holdings-body');
            body.innerHTML = "";
            let total = 0;
            reportData.assets.forEach(a => total += (userHoldings[a.id]||0) * a.price);
            
            reportData.assets.forEach(a => {
                const qty = userHoldings[a.id]||0;
                const val = qty * a.price;
                body.innerHTML += `
                    <tr class="border-b border-slate-50 hover:bg-slate-50">
                        <td class="px-4 py-3 font-medium">${a.name}</td>
                        <td class="px-4 py-3 text-right">CHF ${a.price.toFixed(2)}</td>
                        <td class="px-4 py-3 text-right"><input type="number" value="${qty}" class="share-input" onchange="updateHolding('${a.id}', this.value)"></td>
                        <td class="px-4 py-3 text-right font-mono">CHF ${val.toLocaleString(undefined,{maximumFractionDigits:0})}</td>
                        <td class="px-4 py-3 text-right text-slate-400">${total>0?((val/total)*100).toFixed(1):0}%</td>
                    </tr>`;
            });
            document.getElementById('total-value').innerText = `CHF ${total.toLocaleString(undefined,{maximumFractionDigits:0})}`;
            updatePnL(total);
            updateCharts(total);
        }

        window.updateHolding = function(id, v) { userHoldings[id] = parseInt(v)||0; renderHoldings(); }

        function renderLedger() {
            const body = document.getElementById('ledger-body');
            body.innerHTML = "";
            [...ledger].reverse().forEach((tx, i) => {
                const cls = tx.type==="BUY"?"text-emerald-600 bg-emerald-50":tx.type==="SELL"?"text-red-600 bg-red-50":"text-slate-500 bg-slate-50";
                body.innerHTML += `
                    <tr>
                        <td class="px-6 py-3 font-mono text-xs text-slate-500">${tx.date}</td>
                        <td class="px-6 py-3"><span class="px-2 py-1 rounded text-xs font-bold ${cls}">${tx.type}</span></td>
                        <td class="px-6 py-3 font-medium">${tx.asset}</td>
                        <td class="px-6 py-3 text-right font-mono">${tx.qty}</td>
                        <td class="px-6 py-3 text-right text-slate-500 font-mono editable-price" onclick="editPrice(${ledger.length-1-i})">${tx.price}</td>
                        <td class="px-6 py-3 text-right font-bold text-slate-700">CHF ${tx.total.toLocaleString()}</td>
                    </tr>`;
            });
        }
        window.editPrice = function(i) {
            const p = prompt("New Price:", ledger[i].price);
            if(p) { ledger[i].price=parseFloat(p); ledger[i].total=ledger[i].qty*ledger[i].price; renderLedger(); }
        }

        // --- CHARTS & LOGIC ---
        let perfChart, pieChart, pnlChart;
        function initCharts() {
            // Perf
            const ctxP = document.getElementById('performanceChart').getContext('2d');
            perfChart = new Chart(ctxP, {
                type: 'bar',
                data: { labels: reportData.assets.map(a=>a.name), datasets: [{ data: reportData.assets.map(a=>a.change_1w), backgroundColor: reportData.assets.map(a=>a.color), borderRadius:6 }] },
                options: { responsive:true, maintainAspectRatio:false, indexAxis:'y', plugins:{legend:{display:false}}, scales:{x:{grid:{color:'#f1f5f9'}}, y:{grid:{display:false}}} }
            });
            // Pie
            const ctxPie = document.getElementById('holdingsPieChart').getContext('2d');
            pieChart = new Chart(ctxPie, {
                type: 'doughnut',
                data: { labels: reportData.assets.map(a=>a.name), datasets: [{ data:[], backgroundColor:reportData.assets.map(a=>a.color), borderWidth:0 }] },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, cutout:'70%' }
            });
            // PnL
            const ctxPnL = document.getElementById('pnlBarChart').getContext('2d');
            pnlChart = new Chart(ctxPnL, {
                type: 'bar',
                data: { labels: reportData.assets.map(a=>a.name), datasets: [{ data:[], backgroundColor:reportData.assets.map(a=>a.color), borderRadius:4 }] },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false}, y:{display:false}} }
            });
        }

        window.updatePerf = function(tf) {
            const k = tf==='ytd'?'change_ytd':tf==='1y'?'change_1y':'change_1w';
            perfChart.data.datasets[0].data = reportData.assets.map(a=>a[k]);
            perfChart.update();
        }

        function updateCharts(total) {
            if(!pieChart) return;
            pieChart.data.datasets[0].data = reportData.assets.map(a => total>0 ? ((userHoldings[a.id]*a.price)/total)*100 : 0);
            pieChart.update();
        }

        function updatePnL(total) {
            let sum=0;
            const data = reportData.assets.map(a => { const g=(userHoldings[a.id]*a.price)*(a.change_1w/100); sum+=g; return g; });
            const col = sum>=0?"text-emerald-500":"text-red-500";
            document.getElementById('total-pnl').innerHTML = `<span class="${col}">CHF ${Math.abs(sum).toLocaleString(undefined,{maximumFractionDigits:0})}</span>`;
            document.getElementById('pnl-percent').innerHTML = `${sum>=0?'+':''}${(total>0?(sum/total)*100:0).toFixed(2)}% Weekly`;
            if(pnlChart) { pnlChart.data.datasets[0].data = data; pnlChart.update(); }
        }

        function initMacro() {
            const c = document.getElementById('macro-grid');
            (reportData.macro||[]).forEach(m => {
                const col = m.impact==="Caution"?"border-yellow-400 text-yellow-600":"border-emerald-400 text-slate-500";
                c.innerHTML += `
                    <div class="glass-panel rounded-xl p-5 border-t-4 ${col.split(' ')[0]} card-hover">
                        <div class="text-xs font-bold uppercase text-slate-400 mb-1">${m.name}</div>
                        <div class="text-2xl font-bold text-slate-800 mb-1">${m.value}</div>
                        <div class="text-sm font-medium ${col.split(' ')[1]} mb-3">${m.trend}</div>
                        <p class="text-xs text-slate-500 border-t pt-3">${m.desc}</p>
                    </div>`;
            });
        }

        function initOrders() {
            const l = document.getElementById('order-list');
            (reportData.orders||[]).forEach(o => {
                const bg = o.action==="BUY"?"bg-emerald-50 text-emerald-700 border-emerald-100":o.action==="SELL"?"bg-red-50 text-red-700 border-red-100":"bg-slate-50 text-slate-500 border-slate-100";
                l.innerHTML += `<div class="flex justify-between p-3 rounded border ${bg.split(' ')[2]} ${bg.split(' ')[0]} text-sm items-center"><span class="font-bold ${bg.split(' ')[1]} w-12">${o.action}</span><span class="font-bold text-slate-700">${o.asset}</span><span>${o.reason}</span></div>`;
            });
            document.getElementById('execute-btn').onclick = function() {
                this.innerText = "Done ‚úì"; this.classList.replace('bg-slate-900','bg-emerald-600');
                reportData.orders.forEach(o => { if(o.action!=="HOLD") ledger.push({date:reportData.meta.date, type:o.action, asset:o.asset, qty:o.shares, price:0, total:0}); });
                renderLedger();
            };
        }

        async function getSync() {
            try {
                const r = await fetch(`https://api.github.com/repos/djoms2790/dylan-cio-dashboard/commits/main`);
                const d = await r.json();
                document.getElementById('last-updated').innerText = `Synced: ${new Date(d.commit.author.date).toLocaleString()}`;
            } catch { document.getElementById('last-updated').innerText = "Offline"; }
        }
    </script>
</body>
</html>
